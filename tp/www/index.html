<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <!-- Liens vers les scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<p>Votre ID unique est : <span id="uniqueId"></span></p>
<div id="connectedUsers">
    <h2>Users connected:</h2>
    <ul id="users"></ul>
</div>
<ul id="messages"></ul>
<form id="numberAndMessageForm">
    <input type="number" id="userNumber" name="userNumber" placeholder="Entrez un nombre" />
    <input type="text" id="userMessage" name="userMessage" placeholder="Entrez un message" />
    <button type="submit" id="send">Envoyer</button>
</form>
<form id="refreshUsers">
    <button type="submit" id="refresh">Refresh</button>
</form>
<script>
    const emetId = Math.floor(Math.random() * 1000000);
    document.getElementById('uniqueId').innerText = emetId;
    const socket = io({
        query: {
            id: emetId
        }
    });

    document.getElementById('numberAndMessageForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const userNumber = document.getElementById('userNumber').value;
        const userMessage = document.getElementById('userMessage').value;

        socket.emit('send message', { emet: emetId, mess: userMessage, dest: userNumber });
    });

    document.getElementById('refreshUsers').addEventListener('submit', function(event) {
        event.preventDefault();
        socket.emit('refresh users');
    });

    socket.on('receive message', (msg) => {
        const messageItem = document.createElement('li');
        messageItem.appendChild(document.createTextNode(msg.mess));
        document.getElementById('messages').appendChild(messageItem);
    });

    socket.on('reception users', (users) => {
        const usersList = document.getElementById('users');
        usersList.innerHTML = ''; // Vide la liste des utilisateurs à chaque réception

        users.forEach((user) => {
            const listItem = document.createElement('li');
            listItem.textContent = user;
            usersList.appendChild(listItem);
        });
    });

</script>
</body>
</html>
